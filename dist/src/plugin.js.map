{"version":3,"file":"plugin.js","sourceRoot":"","sources":["../../src/plugin.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Type } from \"@angular/core\";\r\nimport { Severity } from \"./workspace-manager\";\r\nimport { UIEvents } from \"./events\";\r\nimport { PixoworCore } from \"./pixowor-core\";\r\n\r\n/**\r\n * Mod = Cmd on MacOS and Ctrl on other OS\r\n * Ctrl = Ctrl key for every OS\r\n * Meta = Cmd on MacOS and Win key on other OS\r\n * @public\r\n */\r\nexport type Modifier = \"Mod\" | \"Ctrl\" | \"Meta\" | \"Shift\" | \"Alt\";\r\n\r\nexport interface Hotkey {\r\n  modifiers: Modifier[];\r\n  key: string;\r\n}\r\n\r\nexport interface Command {\r\n  /**\r\n   * Globally unique ID to identify this command\r\n   */\r\n  id: string;\r\n\r\n  /**\r\n   * Human friendly name for searching\r\n   */\r\n  name: string;\r\n\r\n  /**\r\n   * Simple callback, triggered globally\r\n   */\r\n  callback?: () => any;\r\n\r\n  hotkeys?: Hotkey[];\r\n}\r\n\r\nexport interface PluginManifest {\r\n  pid: string;\r\n  name: string;\r\n  author: string;\r\n  version: string;\r\n  description: string;\r\n  minAppVersion: string;\r\n  authorUrl?: string;\r\n  dependencies?: { [k: string]: string };\r\n}\r\n\r\nexport abstract class Plugin {\r\n  private _pixoworCore: PixoworCore;\r\n\r\n  public pid: string;\r\n  public name: string;\r\n  public author: string;\r\n  public version: string;\r\n  public description: string;\r\n  public minAppVersion: string;\r\n  public authorUrl?: string;\r\n  public dependencies?: { [k: string]: string };\r\n\r\n  constructor(pixoworCore: PixoworCore, manifest: PluginManifest) {\r\n    this._pixoworCore = pixoworCore;\r\n\r\n    this.pid = manifest.pid;\r\n    this.name = manifest.name;\r\n    this.author = manifest.author;\r\n    this.version = manifest.version;\r\n    this.description = manifest.description;\r\n    this.minAppVersion = manifest.minAppVersion;\r\n    this.authorUrl = manifest.authorUrl;\r\n    this.dependencies = manifest.dependencies;\r\n  }\r\n\r\n  async install() { }\r\n  abstract activate(): void;\r\n  abstract deactivate(): void;\r\n\r\n  /**\r\n   * Get pixowor core\r\n   */\r\n  public get pixoworCore(): PixoworCore {\r\n    return this._pixoworCore;\r\n  }\r\n\r\n  public colorLog(message: string, background: string = \"#222\", color: string = \"#bada55\") {\r\n    console.log(\r\n      `%c ${message}`,\r\n      `background: ${background}; color: ${color}`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Register a command globally. The command id and name will be automatically prefixed with this plugin's id and name.\r\n   * @param command Command\r\n   */\r\n  public addCommand(command: Command) {\r\n    this.pixoworCore.service.registCommand(command);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string} label - Menu label\r\n   * @param {Function} callback - The callback to trigger\r\n   */\r\n  public addMenu(label: string, callback: Function) {\r\n    this.pixoworCore.workspace.emit(UIEvents.ADD_MENU, { label, callback });\r\n  }\r\n\r\n  /**\r\n   * Regist angular component for use.\r\n   * @param  {string} name - Component\r\n   * @param  {Component} component - Register a angular component. The function will use component classname as key to regist.\r\n   */\r\n  public registerComponent(name: string, component: Component) {\r\n    this.pixoworCore.state.registerComponent(name, component);\r\n  }\r\n\r\n  /**\r\n   * DestroyComponent angular component that registed.\r\n   * @param name - Component name\r\n   */\r\n  public destroyComponent(name: string) {\r\n    this.pixoworCore.state.destroyComponent(name);\r\n  }\r\n\r\n  /**\r\n   * Regist variable\r\n   * @param name - variable name\r\n   * @param data - variable init data\r\n   */\r\n  public registerVariable(name: string, data: any = null) {\r\n    if (this.pixoworCore.state.getVariable(name)) {\r\n      this.colorLog(`${name} has been registed by other plugin!`, \"white\", \"red\");\r\n      return\r\n    }\r\n    this.pixoworCore.state.registerVariable(name, data);\r\n  }\r\n\r\n  /**\r\n   * UnRegister variable\r\n   * @param name - variable name\r\n   */\r\n  public unRegisterVariable(name: string) {\r\n    this.pixoworCore.state.unRegisterVariable(name);\r\n  }\r\n\r\n  /**\r\n   * Toast message\r\n   * @param {Severity} severity - Message severity.\r\n   * @param {string} message - Toast message.\r\n   */\r\n  public toast(severity: Severity, message: string) {\r\n    this.pixoworCore.workspace.toast(severity, message);\r\n  }\r\n\r\n  public alert(message: string) {\r\n    this.pixoworCore.workspace.emit(UIEvents.ALERT, { message });\r\n  }\r\n\r\n  /**\r\n   * Open a component you registed in a dialog.\r\n   * @param {string} componentName - Component name.\r\n   */\r\n  public openDialog(componentName: string) {\r\n    this.pixoworCore.workspace.emit(UIEvents.OPEN_DIALOG, { componentName });\r\n  }\r\n\r\n  /**\r\n   * Get value from localstorage\r\n   * @param key localstorage key\r\n   * @returns\r\n   */\r\n  public get(key: string) {\r\n    return this.pixoworCore.storage.get(key);\r\n  }\r\n}\r\n"]}